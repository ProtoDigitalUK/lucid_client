{"version":3,"sources":["../src/index.ts"],"names":["attributes","ids","cookieController","CookieController","options","detailsState","i","detailId","element","key","cookie","e","target","value","type","elements","register","event","fn","timestamp","randomNum","mode","message","state","cookieValue","defaultCookies"],"mappings":"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","sourcesContent":["const attributes = {\r\n\tdetails: \"data-cookie-details\",\r\n\talert: \"data-cookie-alert\",\r\n\tcookieConfig: \"data-cookie-config\",\r\n\taction: {\r\n\t\tattribute: \"data-cookie-action\",\r\n\t\tvalue: {\r\n\t\t\tdismiss: \"dismiss\",\r\n\t\t\taccept: \"accept\",\r\n\t\t\treject: \"reject\",\r\n\t\t\tdetails: \"details\",\r\n\t\t\tsave: \"save\",\r\n\t\t},\r\n\t},\r\n};\r\nconst ids = {\r\n\tdetails: \"cookie-details\",\r\n\talert: \"cookie-alert\",\r\n};\r\n\r\nconst cookieController = \"CookieController\";\r\n\r\nexport default class CookieController {\r\n\tuserOptions: CookieControllerOptionsT = {};\r\n\tstate: CookieStateT = {\r\n\t\tuuid: \"\",\r\n\t\tinteracted: false,\r\n\t\tcookies: {},\r\n\t};\r\n\r\n\tconstructor(options?: CookieControllerOptionsT) {\r\n\t\tif (options) this.userOptions = options;\r\n\t\tthis.initalise();\r\n\t}\r\n\r\n\t// ----------------\r\n\t// Private methods\r\n\tprivate initalise() {\r\n\t\tthis.state = this.cookieState;\r\n\t\tthis.registerEvents();\r\n\t\tthis.setStaticAttributes();\r\n\t\tthis.setDynamicAttributes();\r\n\r\n\t\tif (!this.state.interacted) {\r\n\t\t\tthis.alertState = true;\r\n\t\t}\r\n\r\n\t\tif (this.state.version && this.options.versioning?.current) {\r\n\t\t\tif (this.state.version !== this.options.versioning.current) {\r\n\t\t\t\tif (this.options.versioning.onNewVersion) {\r\n\t\t\t\t\tthis.options.versioning.onNewVersion(\r\n\t\t\t\t\t\tthis.state.version,\r\n\t\t\t\t\t\tthis.options.versioning.current,\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.state.version = this.options.versioning.current;\r\n\t\t\tthis.cookieState = this.state;\r\n\t\t}\r\n\r\n\t\tthis.onConsentChange(\"onload\");\r\n\t}\r\n\tprivate registerEvents() {\r\n\t\tthis.accept = this.accept.bind(this);\r\n\t\tthis.dismiss = this.dismiss.bind(this);\r\n\t\tthis.reject = this.reject.bind(this);\r\n\t\tthis.showDetails = this.showDetails.bind(this);\r\n\t\tthis.onSave = this.onSave.bind(this);\r\n\t\tthis.onCookieChange = this.onCookieChange.bind(this);\r\n\r\n\t\tthis.regEventListenerLoop(this.actionDismiss, true, \"click\", this.dismiss);\r\n\t\tthis.regEventListenerLoop(this.actionAccept, true, \"click\", this.accept);\r\n\t\tthis.regEventListenerLoop(this.actionReject, true, \"click\", this.reject);\r\n\t\tthis.regEventListenerLoop(\r\n\t\t\tthis.actionDetails,\r\n\t\t\ttrue,\r\n\t\t\t\"click\",\r\n\t\t\tthis.showDetails,\r\n\t\t);\r\n\t\tthis.regEventListenerLoop(this.actionSave, true, \"click\", this.onSave);\r\n\t\tthis.regEventListenerLoop(\r\n\t\t\tthis.cookieConfig,\r\n\t\t\ttrue,\r\n\t\t\t\"change\",\r\n\t\t\tthis.onCookieChange,\r\n\t\t);\r\n\t}\r\n\tprivate setDynamicAttributes() {\r\n\t\tconst detailsState = this.detailsState;\r\n\r\n\t\tthis.details?.setAttribute(\"aria-hidden\", detailsState ? \"false\" : \"true\");\r\n\t\tthis.alert?.setAttribute(\"aria-hidden\", detailsState ? \"true\" : \"false\");\r\n\r\n\t\tfor (let i = 0; i < this.actionDetails.length; i++) {\r\n\t\t\tconst element = this.actionDetails[i];\r\n\t\t\telement?.setAttribute(\"aria-expanded\", detailsState ? \"true\" : \"false\");\r\n\t\t}\r\n\t}\r\n\tprivate setStaticAttributes() {\r\n\t\tif (!this.details?.hasAttribute(\"id\"))\r\n\t\t\tthis.details?.setAttribute(\"id\", ids.details);\r\n\t\tif (!this.alert?.hasAttribute(\"id\"))\r\n\t\t\tthis.alert?.setAttribute(\"id\", ids.alert);\r\n\r\n\t\tconst detailId = this.details?.getAttribute(\"id\") as string;\r\n\t\t// const alertId = this.alert?.getAttribute(\"id\") as string;\r\n\r\n\t\tthis.details?.setAttribute(\"role\", \"dialog\");\r\n\t\tthis.details?.setAttribute(\"aria-modal\", \"true\");\r\n\r\n\t\tthis.alert?.setAttribute(\"aria-live\", \"polite\");\r\n\t\tthis.alert?.setAttribute(\"role\", \"alert\");\r\n\r\n\t\tfor (let i = 0; i < this.actionDetails.length; i++) {\r\n\t\t\tconst element = this.actionDetails[i];\r\n\t\t\telement?.setAttribute(\"aria-controls\", detailId);\r\n\t\t\telement?.setAttribute(\"aria-haspopup\", \"dialog\");\r\n\t\t}\r\n\t}\r\n\tprivate getCookieHelper(key: string) {\r\n\t\tconst cookie = document.cookie\r\n\t\t\t.split(\";\")\r\n\t\t\t.find((cookie) => cookie.trim().startsWith(`${key}=`));\r\n\r\n\t\tif (cookie) {\r\n\t\t\tconst cookieValue = cookie.split(\"=\")[1];\r\n\t\t\treturn cookieValue;\r\n\t\t}\r\n\t}\r\n\tprivate onCookieChange(e: Event) {\r\n\t\tif (this.options.mode !== \"onChange\") return;\r\n\r\n\t\tconst target = e.target as HTMLInputElement;\r\n\r\n\t\tconst key = target.getAttribute(attributes.cookieConfig) as string;\r\n\t\tif (!key) return;\r\n\r\n\t\tconst value = target.checked;\r\n\r\n\t\tthis.state.cookies[key] = value;\r\n\t\tthis.cookieState = this.state;\r\n\r\n\t\tthis.onConsentChange(\"cookie\", {\r\n\t\t\tkey,\r\n\t\t\tvalue,\r\n\t\t});\r\n\t}\r\n\tprivate onConsentChange(\r\n\t\ttype: ConsentChangeT[\"type\"],\r\n\t\tcookie?: {\r\n\t\t\tkey: string;\r\n\t\t\tvalue: boolean;\r\n\t\t},\r\n\t) {\r\n\t\tif (this.options.onConsentChange) {\r\n\t\t\tthis.options.onConsentChange({\r\n\t\t\t\ttype,\r\n\t\t\t\tuuid: this.state.uuid,\r\n\t\t\t\tversion: this.state.version,\r\n\t\t\t\tcookies: this.state.cookies,\r\n\t\t\t\tcookie,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tprivate regEventListenerLoop(\r\n\t\telements: NodeListOf<Element | HTMLInputElement>,\r\n\t\tregister: boolean,\r\n\t\tevent: string,\r\n\t\tfn: (e: Event) => void,\r\n\t) {\r\n\t\tfor (let i = 0; i < elements.length; i++) {\r\n\t\t\tif (register) elements[i]?.addEventListener(event, fn);\r\n\t\t\telse elements[i]?.removeEventListener(event, fn);\r\n\t\t}\r\n\t}\r\n\tprivate generateUUID() {\r\n\t\tconst timestamp = Date.now();\r\n\t\tconst randomNum = Math.floor(Math.random() * 1000000);\r\n\t\treturn `${timestamp}-${randomNum}`;\r\n\t}\r\n\r\n\t// ----------------\r\n\t// Public methods\r\n\tdestroy() {\r\n\t\tthis.regEventListenerLoop(this.actionDismiss, false, \"click\", this.dismiss);\r\n\t\tthis.regEventListenerLoop(this.actionAccept, false, \"click\", this.accept);\r\n\t\tthis.regEventListenerLoop(this.actionReject, false, \"click\", this.reject);\r\n\t\tthis.regEventListenerLoop(\r\n\t\t\tthis.actionDetails,\r\n\t\t\tfalse,\r\n\t\t\t\"click\",\r\n\t\t\tthis.showDetails,\r\n\t\t);\r\n\t\tthis.regEventListenerLoop(this.actionSave, false, \"click\", this.onSave);\r\n\t\tthis.regEventListenerLoop(\r\n\t\t\tthis.cookieConfig,\r\n\t\t\tfalse,\r\n\t\t\t\"change\",\r\n\t\t\tthis.onCookieChange,\r\n\t\t);\r\n\t}\r\n\taccept() {\r\n\t\tthis.rejectAccept(\"accept\");\r\n\t}\r\n\treject() {\r\n\t\tthis.rejectAccept(\"reject\");\r\n\t}\r\n\trejectAccept(mode: \"accept\" | \"reject\" = \"accept\") {\r\n\t\tfor (let i = 0; i < this.cookieConfig.length; i++) {\r\n\t\t\tconst element = this.cookieConfig[i];\r\n\t\t\tif (!element) continue;\r\n\t\t\tconst key = element.getAttribute(attributes.cookieConfig) as string;\r\n\t\t\tthis.state.cookies[key] = mode === \"accept\" ? true : false;\r\n\t\t}\r\n\r\n\t\tthis.onConsentChange(mode);\r\n\t\tthis.dismiss();\r\n\t}\r\n\tdismiss() {\r\n\t\tthis.detailsState = false;\r\n\t\tthis.alertState = false;\r\n\r\n\t\tthis.state.interacted = true;\r\n\t\tthis.cookieState = this.state;\r\n\t}\r\n\tshowDetails() {\r\n\t\tfor (let i = 0; i < this.cookieConfig.length; i++) {\r\n\t\t\tconst element = this.cookieConfig[i];\r\n\t\t\tif (!element) continue;\r\n\r\n\t\t\tconst key = element.getAttribute(attributes.cookieConfig) as string;\r\n\t\t\tconst value = this.state.cookies[key];\r\n\t\t\telement.checked = value ? true : false;\r\n\t\t}\r\n\r\n\t\tthis.detailsState = !this.detailsState;\r\n\t\tthis.state.interacted = true;\r\n\t\tthis.cookieState = this.state;\r\n\t}\r\n\tonSave() {\r\n\t\tfor (let i = 0; i < this.cookieConfig.length; i++) {\r\n\t\t\tconst element = this.cookieConfig[i];\r\n\t\t\tif (!element) continue;\r\n\r\n\t\t\tconst key = element.getAttribute(attributes.cookieConfig) as string;\r\n\t\t\tconst value = element.checked;\r\n\t\t\tthis.state.cookies[key] = value;\r\n\t\t}\r\n\r\n\t\tthis.onConsentChange(\"save\");\r\n\t\tthis.dismiss();\r\n\t}\r\n\tgetCookieConsent(key: string) {\r\n\t\treturn this.state.cookies[key];\r\n\t}\r\n\r\n\t// ----------------\r\n\t// Error handling\r\n\tthrowError(message: string) {\r\n\t\tthrow new Error(`[CookieController] ${message}`);\r\n\t}\r\n\r\n\t// ----------------\r\n\t// Setters\r\n\tset alertState(state: boolean) {\r\n\t\tthis.alert?.setAttribute(\"data-cookie-alert\", state ? \"true\" : \"false\");\r\n\t\tthis.setDynamicAttributes();\r\n\t}\r\n\tset detailsState(state: boolean) {\r\n\t\tif (this.alertState) this.alertState = false;\r\n\t\tthis.details?.setAttribute(\"data-cookie-details\", state ? \"true\" : \"false\");\r\n\t\tthis.setDynamicAttributes();\r\n\t}\r\n\tset cookieState(state: CookieStateT) {\r\n\t\tif (!state.uuid) state.uuid = this.generateUUID();\r\n\r\n\t\tconst cookieValue = JSON.stringify(state);\r\n\t\tdocument.cookie = `${cookieController}=${cookieValue};path=/;SameSite=Strict`;\r\n\r\n\t\tthis.state = state;\r\n\t}\r\n\r\n\t// ----------------\r\n\t// getters\r\n\tget options() {\r\n\t\treturn {\r\n\t\t\tmode: this.actionSave.length > 0 ? \"onSave\" : \"onChange\",\r\n\t\t\tonConsentChange: this.userOptions.onConsentChange || null,\r\n\t\t\tversioning: this.userOptions.versioning || null,\r\n\t\t};\r\n\t}\r\n\t// State\r\n\tget alertState() {\r\n\t\treturn this.alert?.getAttribute(\"data-cookie-alert\") === \"true\"\r\n\t\t\t? true\r\n\t\t\t: false;\r\n\t}\r\n\tget detailsState() {\r\n\t\treturn this.details?.getAttribute(\"data-cookie-details\") === \"true\"\r\n\t\t\t? true\r\n\t\t\t: false;\r\n\t}\r\n\tget cookieState() {\r\n\t\tconst defaultCookies: Record<string, boolean> = {};\r\n\t\tfor (let i = 0; i < this.cookieConfig.length; i++) {\r\n\t\t\tconst element = this.cookieConfig[i];\r\n\t\t\tconst key = element?.getAttribute(attributes.cookieConfig) as string;\r\n\t\t\tdefaultCookies[key] = false;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst value = this.getCookieHelper(cookieController);\r\n\t\t\tif (value) {\r\n\t\t\t\treturn JSON.parse(value) as CookieStateT;\r\n\t\t\t}\r\n\t\t\treturn {\r\n\t\t\t\tuuid: \"\",\r\n\t\t\t\tversion: this.options.versioning?.current || undefined,\r\n\t\t\t\tinteracted: false,\r\n\t\t\t\tcookies: defaultCookies,\r\n\t\t\t};\r\n\t\t} catch (error) {\r\n\t\t\treturn {\r\n\t\t\t\tuuid: \"\",\r\n\t\t\t\tversion: this.options.versioning?.current || undefined,\r\n\t\t\t\tinteracted: false,\r\n\t\t\t\tcookies: defaultCookies,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\t// Elements\r\n\tget details() {\r\n\t\treturn document.querySelector(`[${attributes.details}]`);\r\n\t}\r\n\tget alert() {\r\n\t\treturn document.querySelector(`[${attributes.alert}]`);\r\n\t}\r\n\tget cookieConfig() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`input[type=\"checkbox\"][${attributes.cookieConfig}]`,\r\n\t\t) as NodeListOf<HTMLInputElement>;\r\n\t}\r\n\tget actionDismiss() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`[${attributes.action.attribute}=\"${attributes.action.value.dismiss}\"]`,\r\n\t\t);\r\n\t}\r\n\tget actionAccept() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`[${attributes.action.attribute}=\"${attributes.action.value.accept}\"]`,\r\n\t\t);\r\n\t}\r\n\tget actionReject() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`[${attributes.action.attribute}=\"${attributes.action.value.reject}\"]`,\r\n\t\t);\r\n\t}\r\n\tget actionDetails() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`[${attributes.action.attribute}=\"${attributes.action.value.details}\"]`,\r\n\t\t);\r\n\t}\r\n\tget actionSave() {\r\n\t\treturn document.querySelectorAll(\r\n\t\t\t`[${attributes.action.attribute}=\"${attributes.action.value.save}\"]`,\r\n\t\t);\r\n\t}\r\n}\r\n\r\n// ----------------\r\n// Types\r\n\r\ninterface CookieControllerOptionsT {\r\n\tonConsentChange?: (data: ConsentChangeT) => void;\r\n\tversioning?: {\r\n\t\tcurrent: string;\r\n\t\tonNewVersion?: (oldVersion: string, newVersion: string) => void;\r\n\t};\r\n}\r\ninterface ConsentChangeT {\r\n\ttype: \"cookie\" | \"accept\" | \"reject\" | \"save\" | \"onload\";\r\n\tuuid: string;\r\n\tversion?: string;\r\n\r\n\tcookie?: {\r\n\t\tkey: string;\r\n\t\tvalue: boolean;\r\n\t};\r\n\tcookies: Record<string, boolean>;\r\n}\r\n\r\ninterface CookieStateT {\r\n\tuuid: string;\r\n\tversion?: string;\r\n\tinteracted: boolean;\r\n\tcookies: Record<string, boolean>;\r\n}\r\n"]}