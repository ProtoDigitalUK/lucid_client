"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } var _class;var s={details:"data-cookie-details",alert:"data-cookie-alert",cookieConfig:"data-cookie-config",action:{attribute:"data-cookie-action",value:{dismiss:"dismiss",accept:"accept",reject:"reject",details:"details",save:"save"}}},r={details:"cookie-details",alert:"cookie-alert"},c="CookieController",a= exports.default = (_class =class{__init() {this.userOptions={}}__init2() {this.state={uuid:"",interacted:!1,cookies:{}}}constructor(t){;_class.prototype.__init.call(this);_class.prototype.__init2.call(this);t&&(this.userOptions=t),this.initalise()}initalise(){this.state=this.cookieState,this.registerEvents(),this.setStaticAttributes(),this.setDynamicAttributes(),this.state.interacted||(this.alertState=!0),this.state.version&&_optionalChain([this, 'access', _ => _.options, 'access', _2 => _2.versioning, 'optionalAccess', _3 => _3.current])&&(this.state.version!==this.options.versioning.current&&this.options.versioning.onNewVersion&&this.options.versioning.onNewVersion(this.state.version,this.options.versioning.current),this.state.version=this.options.versioning.current,this.cookieState=this.state),this.onConsentChange("onload")}registerEvents(){this.accept=this.accept.bind(this),this.dismiss=this.dismiss.bind(this),this.reject=this.reject.bind(this),this.showDetails=this.showDetails.bind(this),this.onSave=this.onSave.bind(this),this.onCookieChange=this.onCookieChange.bind(this),this.regEventListenerLoop(this.actionDismiss,!0,"click",this.dismiss),this.regEventListenerLoop(this.actionAccept,!0,"click",this.accept),this.regEventListenerLoop(this.actionReject,!0,"click",this.reject),this.regEventListenerLoop(this.actionDetails,!0,"click",this.showDetails),this.regEventListenerLoop(this.actionSave,!0,"click",this.onSave),this.regEventListenerLoop(this.cookieConfig,!0,"change",this.onCookieChange)}setDynamicAttributes(){let t=this.detailsState;_optionalChain([this, 'access', _4 => _4.details, 'optionalAccess', _5 => _5.setAttribute, 'call', _6 => _6("aria-hidden",t?"false":"true")]),_optionalChain([this, 'access', _7 => _7.alert, 'optionalAccess', _8 => _8.setAttribute, 'call', _9 => _9("aria-hidden",t?"true":"false")]);for(let e=0;e<this.actionDetails.length;e++)_optionalChain([this, 'access', _10 => _10.actionDetails, 'access', _11 => _11[e], 'optionalAccess', _12 => _12.setAttribute, 'call', _13 => _13("aria-expanded",t?"true":"false")])}setStaticAttributes(){_optionalChain([this, 'access', _14 => _14.details, 'optionalAccess', _15 => _15.hasAttribute, 'call', _16 => _16("id")])||_optionalChain([this, 'access', _17 => _17.details, 'optionalAccess', _18 => _18.setAttribute, 'call', _19 => _19("id",r.details)]),_optionalChain([this, 'access', _20 => _20.alert, 'optionalAccess', _21 => _21.hasAttribute, 'call', _22 => _22("id")])||_optionalChain([this, 'access', _23 => _23.alert, 'optionalAccess', _24 => _24.setAttribute, 'call', _25 => _25("id",r.alert)]);let t=_optionalChain([this, 'access', _26 => _26.details, 'optionalAccess', _27 => _27.getAttribute, 'call', _28 => _28("id")]);_optionalChain([this, 'access', _29 => _29.details, 'optionalAccess', _30 => _30.setAttribute, 'call', _31 => _31("role","dialog")]),_optionalChain([this, 'access', _32 => _32.details, 'optionalAccess', _33 => _33.setAttribute, 'call', _34 => _34("aria-modal","true")]),_optionalChain([this, 'access', _35 => _35.alert, 'optionalAccess', _36 => _36.setAttribute, 'call', _37 => _37("aria-live","polite")]),_optionalChain([this, 'access', _38 => _38.alert, 'optionalAccess', _39 => _39.setAttribute, 'call', _40 => _40("role","alert")]);for(let e=0;e<this.actionDetails.length;e++){let i=this.actionDetails[e];_optionalChain([i, 'optionalAccess', _41 => _41.setAttribute, 'call', _42 => _42("aria-controls",t)]),_optionalChain([i, 'optionalAccess', _43 => _43.setAttribute, 'call', _44 => _44("aria-haspopup","dialog")])}}getCookieHelper(t){let e=document.cookie.split(";").find(i=>i.trim().startsWith(`${t}=`));if(e)return e.split("=")[1]}onCookieChange(t){if(this.options.mode!=="onChange")return;let e=t.target,i=e.getAttribute(s.cookieConfig);if(!i)return;let o=e.checked;this.state.cookies[i]=o,this.cookieState=this.state,this.onConsentChange("cookie",{key:i,value:o})}onConsentChange(t,e){this.options.onConsentChange&&this.options.onConsentChange({type:t,uuid:this.state.uuid,version:this.state.version,cookies:this.state.cookies,cookie:e})}regEventListenerLoop(t,e,i,o){for(let n=0;n<t.length;n++)e?_optionalChain([t, 'access', _45 => _45[n], 'optionalAccess', _46 => _46.addEventListener, 'call', _47 => _47(i,o)]):_optionalChain([t, 'access', _48 => _48[n], 'optionalAccess', _49 => _49.removeEventListener, 'call', _50 => _50(i,o)])}generateUUID(){let t=Date.now(),e=Math.floor(Math.random()*1e6);return`${t}-${e}`}destroy(){this.regEventListenerLoop(this.actionDismiss,!1,"click",this.dismiss),this.regEventListenerLoop(this.actionAccept,!1,"click",this.accept),this.regEventListenerLoop(this.actionReject,!1,"click",this.reject),this.regEventListenerLoop(this.actionDetails,!1,"click",this.showDetails),this.regEventListenerLoop(this.actionSave,!1,"click",this.onSave),this.regEventListenerLoop(this.cookieConfig,!1,"change",this.onCookieChange)}accept(){this.rejectAccept("accept")}reject(){this.rejectAccept("reject")}rejectAccept(t="accept"){for(let e=0;e<this.cookieConfig.length;e++){let i=this.cookieConfig[e];if(!i)continue;let o=i.getAttribute(s.cookieConfig);this.state.cookies[o]=t==="accept"}this.onConsentChange(t),this.dismiss()}dismiss(){this.detailsState=!1,this.alertState=!1,this.state.interacted=!0,this.cookieState=this.state}showDetails(){for(let t=0;t<this.cookieConfig.length;t++){let e=this.cookieConfig[t];if(!e)continue;let i=e.getAttribute(s.cookieConfig),o=this.state.cookies[i];e.checked=!!o}this.detailsState=!this.detailsState,this.state.interacted=!0,this.cookieState=this.state}onSave(){for(let t=0;t<this.cookieConfig.length;t++){let e=this.cookieConfig[t];if(!e)continue;let i=e.getAttribute(s.cookieConfig),o=e.checked;this.state.cookies[i]=o}this.onConsentChange("save"),this.dismiss()}getCookieConsent(t){return this.state.cookies[t]}throwError(t){throw new Error(`[CookieController] ${t}`)}set alertState(t){_optionalChain([this, 'access', _51 => _51.alert, 'optionalAccess', _52 => _52.setAttribute, 'call', _53 => _53("data-cookie-alert",t?"true":"false")]),this.setDynamicAttributes()}set detailsState(t){this.alertState&&(this.alertState=!1),_optionalChain([this, 'access', _54 => _54.details, 'optionalAccess', _55 => _55.setAttribute, 'call', _56 => _56("data-cookie-details",t?"true":"false")]),this.setDynamicAttributes()}set cookieState(t){t.uuid||(t.uuid=this.generateUUID());let e=JSON.stringify(t);document.cookie=`${c}=${e};path=/;SameSite=Strict`,this.state=t}get options(){return{mode:this.actionSave.length>0?"onSave":"onChange",onConsentChange:this.userOptions.onConsentChange||null,versioning:this.userOptions.versioning||null}}get alertState(){return _optionalChain([this, 'access', _57 => _57.alert, 'optionalAccess', _58 => _58.getAttribute, 'call', _59 => _59("data-cookie-alert")])==="true"}get detailsState(){return _optionalChain([this, 'access', _60 => _60.details, 'optionalAccess', _61 => _61.getAttribute, 'call', _62 => _62("data-cookie-details")])==="true"}get cookieState(){let t={};for(let e=0;e<this.cookieConfig.length;e++){let o=_optionalChain([this, 'access', _63 => _63.cookieConfig, 'access', _64 => _64[e], 'optionalAccess', _65 => _65.getAttribute, 'call', _66 => _66(s.cookieConfig)]);t[o]=!1}try{let e=this.getCookieHelper(c);return e?JSON.parse(e):{uuid:"",version:_optionalChain([this, 'access', _67 => _67.options, 'access', _68 => _68.versioning, 'optionalAccess', _69 => _69.current])||void 0,interacted:!1,cookies:t}}catch (e2){return{uuid:"",version:_optionalChain([this, 'access', _70 => _70.options, 'access', _71 => _71.versioning, 'optionalAccess', _72 => _72.current])||void 0,interacted:!1,cookies:t}}}get details(){return document.querySelector(`[${s.details}]`)}get alert(){return document.querySelector(`[${s.alert}]`)}get cookieConfig(){return document.querySelectorAll(`input[type="checkbox"][${s.cookieConfig}]`)}get actionDismiss(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.dismiss}"]`)}get actionAccept(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.accept}"]`)}get actionReject(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.reject}"]`)}get actionDetails(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.details}"]`)}get actionSave(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.save}"]`)}}, _class);exports.default = a;
//# sourceMappingURL=index.cjs.map