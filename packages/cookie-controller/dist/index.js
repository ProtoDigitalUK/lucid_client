var s={details:"data-cookie-details",alert:"data-cookie-alert",cookieConfig:"data-cookie-config",action:{attribute:"data-cookie-action",value:{dismiss:"dismiss",accept:"accept",reject:"reject",details:"details",save:"save"}}},r={details:"cookie-details",alert:"cookie-alert"},c="CookieController",a=class{userOptions={};state={uuid:"",interacted:!1,cookies:{}};constructor(t){t&&(this.userOptions=t),this.initalise()}initalise(){this.state=this.cookieState,this.registerEvents(),this.setStaticAttributes(),this.setDynamicAttributes(),this.state.interacted||(this.alertState=!0),this.state.version&&this.options.versioning?.current&&(this.state.version!==this.options.versioning.current&&this.options.versioning.onNewVersion&&this.options.versioning.onNewVersion(this.state.version,this.options.versioning.current),this.state.version=this.options.versioning.current,this.cookieState=this.state),this.onConsentChange("onload")}registerEvents(){this.accept=this.accept.bind(this),this.dismiss=this.dismiss.bind(this),this.reject=this.reject.bind(this),this.showDetails=this.showDetails.bind(this),this.onSave=this.onSave.bind(this),this.onCookieChange=this.onCookieChange.bind(this),this.regEventListenerLoop(this.actionDismiss,!0,"click",this.dismiss),this.regEventListenerLoop(this.actionAccept,!0,"click",this.accept),this.regEventListenerLoop(this.actionReject,!0,"click",this.reject),this.regEventListenerLoop(this.actionDetails,!0,"click",this.showDetails),this.regEventListenerLoop(this.actionSave,!0,"click",this.onSave),this.regEventListenerLoop(this.cookieConfig,!0,"change",this.onCookieChange)}setDynamicAttributes(){let t=this.detailsState;this.details?.setAttribute("aria-hidden",t?"false":"true"),this.alert?.setAttribute("aria-hidden",t?"true":"false");for(let e=0;e<this.actionDetails.length;e++)this.actionDetails[e]?.setAttribute("aria-expanded",t?"true":"false")}setStaticAttributes(){this.details?.hasAttribute("id")||this.details?.setAttribute("id",r.details),this.alert?.hasAttribute("id")||this.alert?.setAttribute("id",r.alert);let t=this.details?.getAttribute("id");this.details?.setAttribute("role","dialog"),this.details?.setAttribute("aria-modal","true"),this.alert?.setAttribute("aria-live","polite"),this.alert?.setAttribute("role","alert");for(let e=0;e<this.actionDetails.length;e++){let i=this.actionDetails[e];i?.setAttribute("aria-controls",t),i?.setAttribute("aria-haspopup","dialog")}}getCookieHelper(t){let e=document.cookie.split(";").find(i=>i.trim().startsWith(`${t}=`));if(e)return e.split("=")[1]}onCookieChange(t){if(this.options.mode!=="onChange")return;let e=t.target,i=e.getAttribute(s.cookieConfig);if(!i)return;let o=e.checked;this.state.cookies[i]=o,this.cookieState=this.state,this.onConsentChange("cookie",{key:i,value:o})}onConsentChange(t,e){this.options.onConsentChange&&this.options.onConsentChange({type:t,uuid:this.state.uuid,version:this.state.version,cookies:this.state.cookies,cookie:e})}regEventListenerLoop(t,e,i,o){for(let n=0;n<t.length;n++)e?t[n]?.addEventListener(i,o):t[n]?.removeEventListener(i,o)}generateUUID(){let t=Date.now(),e=Math.floor(Math.random()*1e6);return`${t}-${e}`}destroy(){this.regEventListenerLoop(this.actionDismiss,!1,"click",this.dismiss),this.regEventListenerLoop(this.actionAccept,!1,"click",this.accept),this.regEventListenerLoop(this.actionReject,!1,"click",this.reject),this.regEventListenerLoop(this.actionDetails,!1,"click",this.showDetails),this.regEventListenerLoop(this.actionSave,!1,"click",this.onSave),this.regEventListenerLoop(this.cookieConfig,!1,"change",this.onCookieChange)}accept(){this.rejectAccept("accept")}reject(){this.rejectAccept("reject")}rejectAccept(t="accept"){for(let e=0;e<this.cookieConfig.length;e++){let i=this.cookieConfig[e];if(!i)continue;let o=i.getAttribute(s.cookieConfig);this.state.cookies[o]=t==="accept"}this.onConsentChange(t),this.dismiss()}dismiss(){this.detailsState=!1,this.alertState=!1,this.state.interacted=!0,this.cookieState=this.state}showDetails(){for(let t=0;t<this.cookieConfig.length;t++){let e=this.cookieConfig[t];if(!e)continue;let i=e.getAttribute(s.cookieConfig),o=this.state.cookies[i];e.checked=!!o}this.detailsState=!this.detailsState,this.state.interacted=!0,this.cookieState=this.state}onSave(){for(let t=0;t<this.cookieConfig.length;t++){let e=this.cookieConfig[t];if(!e)continue;let i=e.getAttribute(s.cookieConfig),o=e.checked;this.state.cookies[i]=o}this.onConsentChange("save"),this.dismiss()}getCookieConsent(t){return this.state.cookies[t]}throwError(t){throw new Error(`[CookieController] ${t}`)}set alertState(t){this.alert?.setAttribute("data-cookie-alert",t?"true":"false"),this.setDynamicAttributes()}set detailsState(t){this.alertState&&(this.alertState=!1),this.details?.setAttribute("data-cookie-details",t?"true":"false"),this.setDynamicAttributes()}set cookieState(t){t.uuid||(t.uuid=this.generateUUID());let e=JSON.stringify(t);document.cookie=`${c}=${e};path=/;SameSite=Strict`,this.state=t}get options(){return{mode:this.actionSave.length>0?"onSave":"onChange",onConsentChange:this.userOptions.onConsentChange||null,versioning:this.userOptions.versioning||null}}get alertState(){return this.alert?.getAttribute("data-cookie-alert")==="true"}get detailsState(){return this.details?.getAttribute("data-cookie-details")==="true"}get cookieState(){let t={};for(let e=0;e<this.cookieConfig.length;e++){let o=this.cookieConfig[e]?.getAttribute(s.cookieConfig);t[o]=!1}try{let e=this.getCookieHelper(c);return e?JSON.parse(e):{uuid:"",version:this.options.versioning?.current||void 0,interacted:!1,cookies:t}}catch{return{uuid:"",version:this.options.versioning?.current||void 0,interacted:!1,cookies:t}}}get details(){return document.querySelector(`[${s.details}]`)}get alert(){return document.querySelector(`[${s.alert}]`)}get cookieConfig(){return document.querySelectorAll(`input[type="checkbox"][${s.cookieConfig}]`)}get actionDismiss(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.dismiss}"]`)}get actionAccept(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.accept}"]`)}get actionReject(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.reject}"]`)}get actionDetails(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.details}"]`)}get actionSave(){return document.querySelectorAll(`[${s.action.attribute}="${s.action.value.save}"]`)}};export{a as default};
//# sourceMappingURL=index.js.map